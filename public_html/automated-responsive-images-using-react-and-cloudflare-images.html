<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Automated Responsive Images Using React and Cloudflare Images | Designly</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes" />
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/base16/gigavolt.min.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <!-- We use the full link to the CSS file in the rest of the tags -->
        <link
            rel="preload"
            as="style"
            href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap"
            media="print"
            onload="this.media='all'"
        />
        <noscript>
            <link
                rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap"
            />
        </noscript>
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
        <link rel="manifest" href="/site.webmanifest" />
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000" />
        <meta name="msapplication-TileColor" content="#000000" />
        <meta name="theme-color" content="#ffffff" />
        <meta name="description" content="In today's mobile world, it's important to serve images according to screen size. I'll show you how to automate this process." />
        <meta property="og:title" content="Automated Responsive Images Using React and Cloudflare Images" />
        <meta property="og:description" content="In today's mobile world, it's important to serve images according to screen size. I'll show you how to automate this process." />
        <meta property="og:image" content="https://d340jo5zum8tsx.cloudfront.net/blog_files/react-cloudflare/banner.jpg" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://blog.designly.biz/automated-responsive-images-using-react-and-cloudflare-images" />
        <meta property="og:site_name" content="Designly Blog" />
        <meta property="fb:app_id" content="3419826058233420" />
    </head>
    <body>
        <main id="main" class="bg-zinc-50 dark:bg-zinc-900 min-h-screen pt-[90px] flex flex-col">
            <header
  class="py-2 bg-gradient-to-t from-blue-500 to-blue-700 dark:from-zinc-700 dark:to-zinc-900 shadow-lg fixed top-0 right-0 left-0 z-30"
>
  <nav class="flex justify-between items-center px-4">
    <a href="/" aria-label="Home Page">
      <img
        class="w-[150px] md:w-[175px]"
        src="/assets/svg/designly-logo-white.svg"
        alt="Designly"
        width="175"
        height="62"
      />
    </a>
    <h1 class="text-zinc-50 text-3xl hidden md:block">Developer Blog</h1>
    <div class="flex gap-8 items-center pr-2">
      <button class="btn-search-open" aria-label="Open Search Bar">
        <i class="fa-solid fa-search text-dark-colors text-3xl"></i>
      </button>
      <button class="btn-sidebar-open md:hidden" aria-label="Open Sidebar">
        <i class="fa-solid fa-bars text-dark-colors text-3xl"></i>
      </button>
    </div>
  </nav>
</header>
            <div id="content"><div class="grid grid-cols-1 md:grid-cols-4">
    <div class="col-span-3 px-4 md:px-20 py-10">
        <article class="flex flex-col gap-10 md:px-10">
            <section class="post-header flex flex-col gap-4">
                <h1 id="post-title" class="text-colors text-xl md:text-3xl font-bold">Automated Responsive Images Using React and Cloudflare Images</h1>
                <div class="flex gap-2 items-center tag-list"><a href="/tag/">#Graphics Design</a>
<a href="/tag/cloudflare">#Cloudflare</a>
<a href="/tag/react">#React</a></div>
                <img
                    class="rounded-md shadow-lg"
                    src="https://d340jo5zum8tsx.cloudfront.net/blog_files/react-cloudflare/banner.jpg?w=1200&q=75"
                    srcset="https://d340jo5zum8tsx.cloudfront.net/blog_files/react-cloudflare/banner.jpg?w=640&q=75 640w, https://d340jo5zum8tsx.cloudfront.net/blog_files/react-cloudflare/banner.jpg?w=320&q=75 320w"
                    alt="Automated Responsive Images Using React and Cloudflare Images"
                    width="1200"
                    height="675"
                />
                <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block; text-align: center"
    data-ad-layout="in-article"
    data-ad-format="fluid"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="7647915952"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            </section>
            <section class="post-content flex flex-col gap-6"><p>It's prudent in today's mobile-dominated world to serve images sized accordingly to the client device's screen size. In the days of yore, this required a lot of Javascript code.</p>
<p>Thankfully, most modern browsers accept the <code>srcset</code> property in <code>&lt;img&gt;</code> tags. This property allows you to specify multiple image sources depending on the client's screen size.</p>
<p>Here's a quick example:</p>
<div class="code-wrapper shadow-lg"><pre><code class="language-html hljs xml" data-lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"/images/image-768 768w,
             /images/image-1024.jpg 1024w,
             /images/image-1600.jpg 1600w,
             /images/image-1920.jpg 1920w"</span>
     <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/image.jpg"</span>
/&gt;</span>
</code></pre><span class="mac1"></span><span class="mac2"></span><span class="mac3"></span><button class="code-button" aria-label="Copy to clipboard"><i class="fa-solid fa-copy code-copy-icon"></i></button></div>
<p>The problem with this is that you'll have to pre-render these images for each screen size you intend to serve. This is no only tedius, but also requires a lot of storage on your web server.</p>
<p>There are several image resizing CDNs out there, like <em>imagekit.io</em> and <em>kraken.com</em>, but they are costly. Cloudflare offers a pay-as-you-go image resizing service that allows you to resize images from any source. Cloudflare also caches the resized images for lightening-fast delivery.</p>
<p>In this tutorial, I will be using an <strong>AWS Cloudfront</strong> distribution as the origin source for our Cloudflare images CDN, but you can use any publicly-accessible origin for this to work. For more information on how to set this up, please refer to my articles, <a href="https://designly.biz/blog/post/how-to-use-aws-cloudfront-to-create-your-own-free-cdn" rel="noreferrer noopener" target="_blank">How to Use AWS CloudFront to Create Your Own Free CDN</a> and <a href="https://designly.biz/blog/post/how-to-get-a-custom-domain-for-your-free-cloudfront-cdn" rel="noreferrer noopener" target="_blank">How to Get a Custom Domain For Your Free CloudFront CDN</a>.</p>
<h4>Step 1: Set Up Cloudflare Images</h4>
<p>Assuming you already have a registered Cloudflare account and your DNS hosted there. Create a subdomain like <strong>cdn.example.com</strong> and turn proxy on.</p>
<p>Next, in the sidebar click <em>Speed &gt; Optimization</em> and turn on <em>Image Resizing</em>, and make sure <strong>Resize images from any origin</strong> is <strong>unchecked</strong>. If you leave it checked, anyone will be able to use your CDN url to resize images from any origin!</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image1.jpg?q=75" alt="Enable Resize Images" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image1.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image1.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image1.jpg?w=320&amp;q=75 320w"></p>
<p>You'll need to have a billing account set up with CloudFlare to use the image resizer API. The billable usage is extremely cheap and you'll probably be charged very small amounts of money, unless you have a website with extremely high volume.</p>
<h4>Step 2: Create a Service Worker API Endpoint</h4>
<p>You can use the <strong>cdn_cgi</strong> url method to resize images, but that exposes your source origin and you have to enable <strong>Resize images from any origin</strong> for it to work, so we're not going to do that. Instead, we're going to create a CloudFlare worker to handle our image resizing requests.</p>
<p>In the sidebar of your CloudFlare dashboard, click <strong>Workers</strong> and then click <strong>Create Service</strong>.</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image2.jpg?q=75" alt="Create a New Service Worker" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image2.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image2.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image2.jpg?w=320&amp;q=75 320w"></p>
<p>Enter a <strong>Service Name</strong>. I chose "resizer", but you can name it whatever you want, then click <strong>Create Service</strong>.</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image3.jpg?q=75" alt="Name and Create Your Service" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image3.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image3.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image3.jpg?w=320&amp;q=75 320w"></p>
<p>On the worker settings screen, click the <strong>Quick Edit</strong> button and delete the default code in the left-hand pane. Enter the following code and customize it for your environment:</p>
<div class="code-wrapper shadow-lg"><pre><code class="language-js hljs javascript" data-lang="js">addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {
    event.respondWith(handleRequest(event.request))
})
<span class="hljs-comment">/** GLOBALS */</span>
<span class="hljs-comment">// URL prefix for origin requests</span>
<span class="hljs-keyword">const</span> cdnUrl = <span class="hljs-string">"https://cdn.example.com"</span>;
<span class="hljs-keyword">const</span> defaultImage = cdnUrl + <span class="hljs-string">"/images/image-placeholder.webp"</span>;
<span class="hljs-comment">/**
 * Fetch and log a request
 * @param {Request} request
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-params">request</span>) </span>{
    <span class="hljs-comment">// Parse request URL to get access to query string</span>
    <span class="hljs-keyword">let</span> url = <span class="hljs-keyword">new</span> URL(request.url)
    <span class="hljs-comment">// validate URL pathname</span>
    <span class="hljs-keyword">if</span> (!url.pathname || !url.pathname.length) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">"Missing image path!"</span>);
    }
    imageURL = cdnUrl + url.pathname.replace(<span class="hljs-string">"/resize"</span>, <span class="hljs-string">""</span>); <span class="hljs-comment">// prefix image path with CDN url</span>
    <span class="hljs-comment">// Validation options</span>
    <span class="hljs-keyword">const</span> whRange = [<span class="hljs-number">50</span>, <span class="hljs-number">3000</span>]; <span class="hljs-comment">// width and height range limit</span>
    <span class="hljs-keyword">const</span> formats = [<span class="hljs-string">'webp'</span>, <span class="hljs-string">'avif'</span>, <span class="hljs-string">'json'</span>];
    <span class="hljs-keyword">const</span> fitVals = [<span class="hljs-string">'scale-down'</span>, <span class="hljs-string">'contain'</span>, <span class="hljs-string">'cover'</span>, <span class="hljs-string">'crop'</span>, <span class="hljs-string">'pad'</span>];
    <span class="hljs-keyword">const</span> gravityVals = [<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>, <span class="hljs-string">'top'</span>, <span class="hljs-string">'bottom'</span>, <span class="hljs-string">'center'</span>, <span class="hljs-string">'auto'</span>]; <span class="hljs-comment">// also can be object int {x, y}</span>
    <span class="hljs-keyword">const</span> qualityRange = [<span class="hljs-number">60</span>, <span class="hljs-number">90</span>]; <span class="hljs-comment">// actually 0-100 but 60-90 is usable range</span>
    <span class="hljs-keyword">const</span> rotateVals = [<span class="hljs-number">90</span>, <span class="hljs-number">180</span>, <span class="hljs-number">270</span>]; <span class="hljs-comment">// Only multiples of 90 allowed</span>
    <span class="hljs-keyword">const</span> sharpenRange = [<span class="hljs-number">0</span>, <span class="hljs-number">10</span>]; <span class="hljs-comment">// float:  1.0 recommended for down-scaled images</span>
    <span class="hljs-keyword">const</span> blurRange = [<span class="hljs-number">0</span>, <span class="hljs-number">250</span>]
    <span class="hljs-comment">// Cloudflare-specific options are in the cf object.</span>
    <span class="hljs-keyword">let</span> options = { <span class="hljs-attr">cf</span>: { <span class="hljs-attr">image</span>: {} } }
    <span class="hljs-comment">// Copy parameters from query string to request options.</span>
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"fit"</span>)) options.cf.image.fit = url.searchParams.get(<span class="hljs-string">"fit"</span>)
    <span class="hljs-comment">// fit accepted value: object: {top, right, bottom, left}</span>
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"w"</span>)) options.cf.image.width = url.searchParams.get(<span class="hljs-string">"w"</span>)
    <span class="hljs-comment">// width accepted value 50-3000</span>
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"h"</span>)) options.cf.image.height = url.searchParams.get(<span class="hljs-string">"h"</span>)
    <span class="hljs-comment">// height accepted value: 50-3000</span>
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"q"</span>)) options.cf.image.quality = url.searchParams.get(<span class="hljs-string">"q"</span>)
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"r"</span>)) options.cf.image.rotate = url.searchParams.get(<span class="hljs-string">"r"</span>)
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"sharpen"</span>)) options.cf.image.sharpen = url.searchParams.get(<span class="hljs-string">"sharpen"</span>)
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"blur"</span>)) options.cf.image.blur = url.searchParams.get(<span class="hljs-string">"blur"</span>)
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"t"</span>)) options.cf.image.trim = url.searchParams.get(<span class="hljs-string">"t"</span>)
    <span class="hljs-keyword">if</span> (url.searchParams.has(<span class="hljs-string">"g"</span>)) options.cf.image.gravity = url.searchParams.get(<span class="hljs-string">"g"</span>)
    <span class="hljs-comment">// Validate parameters</span>
    <span class="hljs-keyword">if</span> (options.cf.image.fit &amp;&amp; !fitVals.includes(options.cf.image.fit)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">"Invalid value for fit!"</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.width &amp;&amp; !inRange(options.cf.image.width, whRange)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid width range [<span class="hljs-subst">${whRange.join(<span class="hljs-string">"-"</span>)}</span>]`</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.height &amp;&amp; !inRange(options.cf.image.height, whRange)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid height range [<span class="hljs-subst">${whRange.join(<span class="hljs-string">"-"</span>)}</span>]`</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.quality &amp;&amp; !inRange(options.cf.image.quality, qualityRange)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid quality range [<span class="hljs-subst">${qualityRange.join(<span class="hljs-string">"-"</span>)}</span>]`</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.rotate &amp;&amp; !rotateVals.includes(options.cf.image.rotate)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid rotate value [<span class="hljs-subst">${rotateVals.join(<span class="hljs-string">"|"</span>)}</span>]`</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.sharpen &amp;&amp; !inRange(options.cf.image.sharpen, sharpenRange)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid sharpen range [<span class="hljs-subst">${sharpenRange.join(<span class="hljs-string">"-"</span>)}</span>]`</span>);
    }
    <span class="hljs-keyword">if</span> (options.cf.image.blur &amp;&amp; !inRange(options.cf.image.blur, blurRange)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorDefault(<span class="hljs-string">`Invalid blur range [<span class="hljs-subst">${blurRange.join(<span class="hljs-string">"-"</span>)}</span>]`</span>);
    }
    <span class="hljs-comment">// Your Worker is responsible for automatic format negotiation. Check the Accept header.</span>
    <span class="hljs-comment">// Try webp first, then avif</span>
    <span class="hljs-keyword">const</span> accept = request.headers.get(<span class="hljs-string">"Accept"</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/image\/webp/</span>.test(accept)) {
        options.cf.image.format = <span class="hljs-string">'webp'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/image\/avif/</span>.test(accept)) {
        options.cf.image.format = <span class="hljs-string">'avif'</span>;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> { hostname, pathname } = <span class="hljs-keyword">new</span> URL(imageURL)
        <span class="hljs-comment">// only allow URLs with JPEG, PNG, GIF, or WebP file extensions</span>
        <span class="hljs-comment">// @see https://developers.cloudflare.com/images/url-format#supported-formats-and-limitations</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/\.(jpe?g|png|gif|webp)$/i</span>.test(pathname)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-string">'Disallowed file extension'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> })
        }
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-string">'Invalid "image" value'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> })
    }
    <span class="hljs-comment">// Build a request that passes through request headers</span>
    <span class="hljs-keyword">const</span> imageRequest = <span class="hljs-keyword">new</span> Request(imageURL, {
        <span class="hljs-attr">headers</span>: request.headers
    })
    <span class="hljs-built_in">console</span>.log(options);
    <span class="hljs-comment">// Returning fetch() with resizing options will pass through response with the resized image.</span>
    <span class="hljs-keyword">return</span> fetch(imageRequest, options)
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErrorDefault</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Response</span> </span>{
    <span class="hljs-keyword">constructor</span>(message, props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Image resize error: "</span> + message);
        <span class="hljs-keyword">return</span> fetch(defaultImage, { <span class="hljs-attr">status</span>: <span class="hljs-number">200</span> });
    }
}
<span class="hljs-comment">// Helper functions</span>
<span class="hljs-keyword">const</span> inRange = <span class="hljs-function">(<span class="hljs-params">v, [x, y]</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (v &gt;= x &amp;&amp; v &lt;= y);
}
</code></pre><span class="mac1"></span><span class="mac2"></span><span class="mac3"></span><button class="code-button" aria-label="Copy to clipboard"><i class="fa-solid fa-copy code-copy-icon"></i></button></div>
<p>Change the <code>cdnUrl</code> constant to your CDN base URL. Make any other modifications you'd like and then click <strong>Save and Deploy</strong>.</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image4.jpg?q=75" alt="Copy and Paste the Code" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image4.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image4.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image4.jpg?w=320&amp;q=75 320w"></p>
<p>Go back to your service screen and click <strong>Triggers</strong> and click <strong>Add Route</strong>.</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image5.jpg?q=75" alt="Add a Route to Your Service" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image5.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image5.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image5.jpg?w=320&amp;q=75 320w"></p>
<p>Under <strong>Route</strong> you'll enter something like <code>https://cdn.example.com/resizer*</code>. What this does is intercept any URL with this prefix and runs it through the service worker. Any pathname after this prefix is extracted and your <code>cdnUrl</code> constant value is prepended to it. Any resizing options are configured via query parameters.</p>
<p><img src="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image6.jpg?q=75" alt="Create Your Route" class="blog-post-image" width="1920" height="1080" data-original="https://cdn.designly.biz/blog_files/react-cloudflare/image6.jpg" srcset="https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image6.jpg?w=640&amp;q=75 640w, https://cdn.designly.biz/imgr/blog_files/react-cloudflare/image6.jpg?w=320&amp;q=75 320w"></p>
<p>Ok! Let's try it out. Try requesting an image from your new service worker like this: <code>https://cdn.example.com/resizer/images/some-image.jpg?w=760</code>, where <code>/images/some-image.jpg</code> is the relative path to your CDN url.</p>
<p>I've coded several of the available resizing options into this script, but there are more to choose from. For more information about using CloudFlare's image resizing API, please <a href="https://developers.cloudflare.com/images/image-resizing/resize-with-workers/" rel="noreferrer noopener" target="_blank">click here</a>.</p>
<p>Now, you could stop here and use this service however you please, but if you're a React/NextJS developer, read on!</p>
<h4>Step 3: Create a React Custom Component</h4>
<p>The title of this article indicates that we're going to <strong>automate</strong> this process, and that's exactly what we're going to do now.</p>
<p>Consider the following code:</p>
<div class="code-wrapper shadow-lg"><pre><code class="language-js hljs javascript" data-lang="js"><span class="hljs-keyword">const</span> resizeUrl = <span class="hljs-string">"https://cdn.example.com/resizer%SRC%?w=%WIDTH%&amp;q=%QUALITY%"</span>;
<span class="hljs-keyword">const</span> imageResizerConfig = {
    <span class="hljs-attr">resizeUrl</span>: resizeUrl,
    <span class="hljs-attr">cfSrcSetUrl</span>: resizeUrl + <span class="hljs-string">" %WIDTH%w"</span>,
    <span class="hljs-attr">srcSetWidths</span>: [<span class="hljs-number">640</span>, <span class="hljs-number">768</span>, <span class="hljs-number">1024</span>, <span class="hljs-number">1366</span>, <span class="hljs-number">1600</span>, <span class="hljs-number">1920</span>],
    <span class="hljs-attr">srcSetDefaultWidth</span>: <span class="hljs-number">1024</span>,
    <span class="hljs-attr">placeholderImage</span>: <span class="hljs-string">"/images/pixel-black.png"</span>,
    <span class="hljs-attr">defaultQuality</span>: <span class="hljs-number">90</span>,
    <span class="hljs-attr">blogThumbQuality</span>: <span class="hljs-number">60</span>
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CfImage</span>(<span class="hljs-params">{
    defaultWidth = imageResizerConfig.srcSetDefaultWidth,
    maxWidth = null,
    src,
    className,
    alt,
    onClick,
    quality = imageResizerConfig.defaultQuality
}</span>) </span>{
    <span class="hljs-keyword">const</span> srcSet = [];
    imageResizerConfig.srcSetWidths.forEach(<span class="hljs-function">(<span class="hljs-params">w</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!maxWidth || w &lt;= maxWidth) {
            srcSet.push(imageResizerConfig.cfSrcSetUrl.replace(<span class="hljs-regexp">/%WIDTH%/g</span>, w).replace(<span class="hljs-string">"%SRC%"</span>, src).replace(<span class="hljs-string">"%QUALITY%"</span>, quality));
        }
    });
    <span class="hljs-keyword">if</span> (defaultWidth &gt; maxWidth) {
        defaultWidth = maxImageWidth(maxWidth);
    }
    <span class="hljs-keyword">const</span> srcMain = imageResizerConfig.resizeUrl.replace(<span class="hljs-regexp">/%WIDTH%/g</span>, defaultWidth).replace(<span class="hljs-string">"%SRC%"</span>, src).replace(<span class="hljs-string">"%QUALITY%"</span>, quality);
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{className}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{srcMain}</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">{srcSet.join(</span>',')} <span class="hljs-attr">alt</span>=<span class="hljs-string">{alt}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span> /&gt;</span></span>
    );
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">maxImageWidth</span>(<span class="hljs-params">maxWidth</span>) </span>{
    <span class="hljs-keyword">const</span> useWidths = [];
    imageResizerConfig.srcSetWidths.forEach(<span class="hljs-function">(<span class="hljs-params">w</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!maxWidth || w &lt;= maxWidth) {
            useWidths.push(w);
        }
    });
    useWidths.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a - b;
    });
    <span class="hljs-keyword">return</span> useWidths.pop();
}
</code></pre><span class="mac1"></span><span class="mac2"></span><span class="mac3"></span><button class="code-button" aria-label="Copy to clipboard"><i class="fa-solid fa-copy code-copy-icon"></i></button></div>
<p>What this component does is render an <code>&lt;img&gt;</code> tag with preset <code>srcset</code> URLs for sizes <code>[640, 768, 1024, 1366, 1600, 1920]</code>. These are arbitrary sizes I chose based on common mobile and desktop screen sizes. The largest size you'd likely need is 1920 for HD desktop screens, so your original source image need not be a higher resolution than that.</p>
<p>You can then import this component into your React pages and call it like this:</p>
<div class="code-wrapper shadow-lg"><pre><code class="language-js hljs javascript" data-lang="js">  &lt;CfImage
    {...this.props}
    className=<span class="hljs-string">"pop-image"</span>
    src=<span class="hljs-string">"/images/path/to/image.jpg"</span>
    onClick={handleClick}
    alt=<span class="hljs-string">"My image description"</span>
    maxWidth={<span class="hljs-keyword">this</span>.state.winWidth}
    quality=<span class="hljs-number">60</span>
  /&gt;
</code></pre><span class="mac1"></span><span class="mac2"></span><span class="mac3"></span><button class="code-button" aria-label="Copy to clipboard"><i class="fa-solid fa-copy code-copy-icon"></i></button></div>
<p>This code should render something like this:</p>
<div class="code-wrapper shadow-lg"><pre><code class="language-html hljs xml" data-lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"pop-image"</span>
    <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/resizer/images/path/to/image.jpg?w=1024&amp;q=60"</span>
    <span class="hljs-attr">srcset</span>=<span class="hljs-string">"https://cdn.example.com/resizer/images/path/to/image.jpg?w=640&amp;q=60 640w,
            https://cdn.example.com/resizer/images/path/to/image.jpg?w=768&amp;q=60 768w,
            https://cdn.example.com/resizer/images/path/to/image.jpg?w=1024&amp;q=60 1024w,
            https://cdn.example.com/resizer/images/path/to/image.jpg?w=1366&amp;q=60 1366w,
            https://cdn.example.com/resizer/images/path/to/image.jpg?w=1600&amp;q=60 1600w,
            https://cdn.example.com/resizer/images/path/to/image.jpg?w=1920&amp;q=60 1920w"</span>
    <span class="hljs-attr">alt</span>=<span class="hljs-string">"My Image description"</span>
/&gt;</span>
</code></pre><span class="mac1"></span><span class="mac2"></span><span class="mac3"></span><button class="code-button" aria-label="Copy to clipboard"><i class="fa-solid fa-copy code-copy-icon"></i></button></div>
<p>That's it. Now you have a fully-automated image resizer. All you need to do is publish your images at 1920w in JPG or PNG format and CloudFlare will optimize the image based on the HTTP Accept header, whether it's webp or avif.</p>
<p>Feel free to play around with this code and customize it to suit your needs.</p>
<p>Thanks for reading! For more great information, please visit our <a href="https://designly.biz/blog" rel="noreferrer noopener" target="_blank">Blog</a>.</p>
</section>
            <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block; text-align: center"
    data-ad-layout="in-article"
    data-ad-format="fluid"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="7647915952"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            <div class="share-buttons text-2xl flex gap-4 mx-auto">
                <h2 class="text-2xl font-bold text-colors">Please Share!</h2>
                <a
                    href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.designly.biz%2Fautomated-responsive-images-using-react-and-cloudflare-images"
                    target="_blank"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook text-blue-700"></i>
                </a>
                <a
                    href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.designly.biz%2Fautomated-responsive-images-using-react-and-cloudflare-images"
                    target="_blank"
                    aria-label="Share on LinkedIn"
                >
                    <i class="fab fa-linkedin text-indigo-700"></i>
                </a>
                <a href="https://twitter.com/share?url=https%3A%2F%2Fblog.designly.biz%2Fautomated-responsive-images-using-react-and-cloudflare-images" target="_blank">
                    <i class="fab fa-twitter text-sky-700"></i>
                </a>
            </div>
            <hr />
            <div class="bg-white dark:bg-zinc-800 border-1 rounded-lg flex flex-col shadow p-6 max-w-xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-y-4">
                    <div class="col-span-1 flex items-center">
                        <img
                            src="https://cdn.designly.biz/imgr/jay.jpg?w=200&q=75"
                            alt="Jay"
                            width="200"
                            height="200"
                            class="rounded-full shadow-md border-4 border-blue-700/20 w-32 h-32 mx-auto"
                        />
                    </div>
                    <div class="col-span-3 px-6 flex flex-col gap-4">
                        <h3 class="text-2xl font-semibold text-center text-colors">About The Author</h3>
                        <p class="text-zinc-700 dark:text-zinc-300">
                            Jay is a full-stack developer, electrical engineer, writer and music producer. He currently
                            resides in the Madison, WI area.
                        </p>
                        <a
                            href="https://jay.designly.biz"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="text-hover flex gap-2 items-center"
                        >
                            <div>Portfolio Site</div>
                            <i class="fa-solid fa-external-link"></i>
                        </a>
                    </div>
                </div>
            </div>
            <hr />
            <h2 class="text-2xl font-bold text-center border-b-2 border-dashed pb-1 text-colors">Comments</h2>
            <div id="comments" class="text-colors">
                <!-- Comments will be generated here -->
                <p>No Comments Yet</p>
            </div>
            <button id="btn-post-comment" class="btn btn-primary btn-outline flex gap-2 items-center max-w-md mx-auto">
                <i class="fas fa-comment-medical"></i>
                <div>Post Comment</div>
            </button>
            <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block; text-align: center"
    data-ad-layout="in-article"
    data-ad-format="fluid"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="7647915952"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            <template id="comment-template" class="text-colors">
                <div
                    class="comment flex flex-col gap-4 p-4 border rounded shadow mb-4 bg-white dark:bg-zinc-800 text-colors"
                >
                    <div class="flex gap-2 items-center">
                        <img
                            class="comment-avatar rounded-full w-10 h-10"
                            src="/assets/img/pixel-black.png"
                            width="100"
                            height="100"
                            alt="Commenter Avatar"
                        />
                        <div class="comment-display-name text-2xl text-cyan-700"></div>
                    </div>
                    <p class="comment-text"></p>
                    <div class="replies ml-4">
                        <!-- Replies will be generated here -->
                    </div>
                    <button class="reply-button mt-2 text-hover flex gap-2 items-center">
                        <i class="fas fa-comment-dots"></i>
                        <div>Reply</div>
                    </button>
                </div>
            </template>
        </article>
    </div>
    <div class="sidebar">
    <button class="btn top-4 left-4 btn-sidebar-close flex md:hidden btn-sidebar-close z-40 shadow-xl"
        aria-label="Close sidebar">
        <i class="fa-solid fa-times text-2xl"></i>
    </button>
    <div id="post-sidebar-cont" class="flex flex-col gap-8">
        <a href="/building-an-ai-search-app-with-next-js-and-openai-a-step-by-step-guide">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/building-an-ai-search-app-with-next-js-and-openai-a-step-by-step-guide/cover.jpg?w=400&q=75" alt="Building an AI Search App with Next.js and OpenAI: A Step-by-step Guide" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Building an AI Search App with Next.js and OpenAI: A Step-by-step Guide</h1>
            <p class="text-zinc-600 text-lg md:text-sm">Today, we're taking a deep dive into the realm of AI-driven searches, using a powerful tech stack comprising Next.js, Sequelize, PostgreSQL, pgvector, and the OpenAI API.</p>
        </div>
    </div>
</a>
<a href="/github-copilot-vs-codewhisperer-the-verdict">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/github-copilot-vs-codewhisperer-the-verdict/cover.jpg?w=400&q=75" alt="GitHub Copilot vs CodeWhisperer: The Verdict" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">GitHub Copilot vs CodeWhisperer: The Verdict</h1>
            <p class="text-zinc-600 text-lg md:text-sm">In this blog post, I'll take you through my journey, share my insights, and finally, reveal the winner in the showdown between GitHub Copilot and AWS CodeWhisperer.</p>
        </div>
    </div>
</a>
<a href="/creating-an-install-to-home-screen-prompt-in-a-next-js-progressive-web-app">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/creating-an-install-to-home-screen-prompt-in-a-next-js-progressive-web-app/cover.jpg?w=400&q=75" alt="Creating an "Install to Home Screen" Prompt in a Next.js Progressive Web App" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Creating an "Install to Home Screen" Prompt in a Next.js Progressive Web App</h1>
            <p class="text-zinc-600 text-lg md:text-sm">Step-by-step guide to creating an 'Add to Home Screen' prompt for Next.js PWAs, targeting major mobile browsers to enhance user experience.</p>
        </div>
    </div>
</a>
<script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block"
    data-ad-format="fluid"
    data-ad-layout-key="+13+qh+1q+m+1y"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="2598499752"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<a href="/create-an-attractive-file-upload-widget-with-react-nextjs-and-tailwind-css">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/create-an-attractive-file-upload-widget-with-react-nextjs-and-tailwind-css/cover.jpg?w=400&q=75" alt="How to Create an Attractive File Upload Widget With React/Next.js and Tailwind CSS" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">How to Create an Attractive File Upload Widget With React/Next.js and Tailwind CSS</h1>
            <p class="text-zinc-600 text-lg md:text-sm">By leveraging the strengths of React, Tailwind CSS, and Daisy UI, we can create a user-friendly and aesthetically pleasing file uploader.</p>
        </div>
    </div>
</a>
<a href="/react-and-tailwind-css-making-a-typewriter-animation-from-scratch">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/react-and-tailwind-css-making-a-typewriter-animation-from-scratch/cover.jpg?w=400&q=75" alt="React and Tailwind CSS: Making a Typewriter Animation from Scratch" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">React and Tailwind CSS: Making a Typewriter Animation from Scratch</h1>
            <p class="text-zinc-600 text-lg md:text-sm">Learn to create a typewriter animation using React and Tailwind CSS. Step-by-step guide to add a retro touch to your web design.</p>
        </div>
    </div>
</a>
<a href="/animating-the-web-route-transitions-in-next-js-with-framer-motion">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/animating-the-web-route-transitions-in-next-js-with-framer-motion/cover.jpg?w=400&q=75" alt="Animating the Web: Route Transitions in Next.js with Framer Motion" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Animating the Web: Route Transitions in Next.js with Framer Motion</h1>
            <p class="text-zinc-600 text-lg md:text-sm">This article aims to be your comprehensive guide on how to enhance your Next.js applications with smooth, compelling route transitions using Framer Motion.</p>
        </div>
    </div>
</a>
<script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block"
    data-ad-format="fluid"
    data-ad-layout-key="+13+qh+1q+m+1y"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="2598499752"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<a href="/enhancing-form-usability-with-framer-motion-a-guide-to-animated-chunked-form">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/enhancing-form-usability-with-framer-motion-a-guide-to-animated-chunked-form/cover.jpg?w=400&q=75" alt="Enhancing Form Usability with Framer Motion: A Guide to Animated, Chunked Form Transitions" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Enhancing Form Usability with Framer Motion: A Guide to Animated, Chunked Form Transitions</h1>
            <p class="text-zinc-600 text-lg md:text-sm">Enhance form UX with Framer Motion: Break forms into chunks, animate transitions, and improve user experience for seamless interaction.</p>
        </div>
    </div>
</a>
<a href="/easy-dropdown-menus-with-next-js-and-tailwind-css">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/easy-dropdown-menus-with-next-js-and-tailwind-css/cover.jpg?w=400&q=75" alt="Easy Dropdown Menus With Next.js and Tailwind CSS" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Easy Dropdown Menus With Next.js and Tailwind CSS</h1>
            <p class="text-zinc-600 text-lg md:text-sm">In this article, I'm going to show you how to create a very simple, yet elegant, dropdown menu using nothing but Next.js and Tailwind CSS.</p>
        </div>
    </div>
</a>
<a href="/creating-a-basic-authentication-provider-in-next-js">
    <div class="flex flex-col rounded-lg overflow-hidden bg-zinc-100 dark:bg-zinc-800 shadow-md min-h-[400px]">
        <div class="relative overflow-hidden h-[250px]">
            <img class="w-full object-cover" src="https://cdn.designly.biz/imgr/blog_files/creating-a-basic-authentication-provider-in-next-js/cover.jpg?w=400&q=75" alt="Creating a Basic Authentication Provider in Next.js" loading="lazy" />
        </div>
        <div class="p-4 flex flex-col gap-2">
            <h1 class="text-xl font-bold">Creating a Basic Authentication Provider in Next.js</h1>
            <p class="text-zinc-600 text-lg md:text-sm">In this tutorial, we'll walk you through the process of creating a basic authentication provider in Next.js.</p>
        </div>
    </div>
</a>
<script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8001907419576129"
    crossorigin="anonymous"
></script>
<ins
    class="adsbygoogle"
    style="display: block"
    data-ad-format="fluid"
    data-ad-layout-key="+13+qh+1q+m+1y"
    data-ad-client="ca-pub-8001907419576129"
    data-ad-slot="2598499752"
></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
    <div id="post-list-bottom"></div>
</div>
</div>
<input id="post-id" type="hidden" value="7AUo6la41VzKXMwST1YISx" />
<input id="reply-to" type="hidden" value="" />
<input id="post-url" type="hidden" value="https://blog.designly.biz/automated-responsive-images-using-react-and-cloudflare-images" />
<script>
    function generateComment(commentData) {
        const template = document.querySelector("#comment-template");
        const clone = template.content.cloneNode(true);
        const displayName = clone.querySelector(".comment-display-name");
        displayName.textContent = commentData.displayName;
        const commentAvatar = clone.querySelector(".comment-avatar");
        commentAvatar.setAttribute("src", commentData.avatar);
        const commentText = clone.querySelector(".comment-text");
        commentText.textContent = commentData.comment;
        const repliesContainer = clone.querySelector(".replies");
        commentData.replies.forEach((reply) => {
            const replyElement = generateComment(reply);
            repliesContainer.appendChild(replyElement);
        });
        const replyButton = clone.querySelector(".reply-button");
        replyButton.addEventListener("click", () => {
            document.getElementById("reply-to").value = commentData._id;
            loadUrl("/comment");
        });
        return clone;
    }
    const fetchComments = async () => {
        const postId = document.getElementById("post-id").value;
        try {
            const result = await fetch(`https://blog-comments.designly.workers.dev/?postId=${postId}`);
            const comments = await result.json();
            const commentsContainer = document.querySelector("#comments");
            if (Array.isArray(comments) && comments.length) {
                commentsContainer.innerHTML = "";
                comments.forEach((comment) => {
                    const commentElement = generateComment(comment);
                    commentsContainer.appendChild(commentElement);
                });
            }
        } catch (err) {
            console.error(err);
        }
    };
    setTimeout(async () => {
        fetchComments();
        document.getElementById("btn-post-comment").addEventListener("click", () => {
            loadUrl(`/comment`);
        });
    }, 0);
</script>
</div>
            <footer class="flex justify-around items-center py-2 bg-gradient-to-b from-blue-500 to-blue-700 text-white dark:from-zinc-500 dark:to-zinc-700 mt-auto">
    <div>&copy; 2008 - 2023 Designly</div>
</footer>
        </main>
        <div id="image-viewer" class="fixed top-0 right-0 bottom-0 left-0 z-50 hidden bg-zinc-900">
            <button class="fixed top-4 left-4 btn-close-image-viewer">
                <i class="fa-solid fa-times text-xl text-hover text-white"></i>
            </button>
            <img
                id="image-viewer-img"
                class="m-auto w-full btn-close-image-viewer cursor-zoom-out"
                alt="Full Size Image"
                src="/assets/img/pixel-black.png"
                width="1920"
                height="1080"
            />
        </div>
        <div
            id="loading"
            class="fixed top-0 right-0 bottom-0 left-0 bg-black/80 flex justify-around items-center z-50"
            style="display: none"
        >
            <div class="flex flex-col gap-4">
                <img src="/assets/svg/notes-light.svg" alt="Bouncy Notes" width="200" height="200" />
                <h1 class="text-zinc-100 text-2xl text-center font-semibold animate-pulse">Loading...</h1>
            </div>
        </div>
        <div
            id="layer"
            class="fixed top-0 right-0 bottom-0 left-0 flex flex-col m-auto w-full bg-zinc-50 dark:bg-zinc-900 z-30 overflow-x-auto"
            style="display: none"
        ></div>
        <script>
    function loadLayer(html) {
        const layer = document.getElementById("layer");
        const parser = new DOMParser();
        const parsed = parser.parseFromString(html, "text/html");
        layer.innerHTML = parsed.body.innerHTML;
        const scripts = parsed.body.querySelectorAll("script");
        for (let i = 0; i < scripts.length; i++) {
            const script = document.createElement("script");
            for (let key in scripts[i].attributes) {
                script.setAttribute(key, scripts[i].attributes[key].value);
            }
            script.innerHTML = scripts[i].innerHTML;
            layer.appendChild(script);
        }
        layer.style.display = "flex";
    }
    function loadUrl(url) {
        loadingOn();
        fetch(url)
            .then((res) => res.text())
            .then((data) => {
                loadLayer(data);
            })
            .catch((err) => {
                console.error(err);
            })
            .finally(() => {
                loadingOff();
            });
    }
    function hideLayer() {
        const layer = document.getElementById("layer");
        layer.style.display = "none";
    }
    function loadingOn() {
        const loading = document.getElementById("loading");
        loading.style.display = "flex";
    }
    function loadingOff() {
        const loading = document.getElementById("loading");
        loading.style.display = "none";
    }
</script>
        <script src="/assets/js/index.js" defer></script>
        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit"></script>
    </body>
</html>